pipeline {
  agent any
  
  environment {
    //once you create ACR in Azure cloud, use that here
    REGISTRY_ADDRESS = "lsepocnodejs.azurecr.io"
    APPLICATION_NAME = "lsepocnodejs"
    //- update your credentials ID after creating credentials for connecting to ACR
     POC_ACR_CREDENTIALS = credentials('ACR_LSS_POC')
  }



  stages {
    stage ('Docker build image') {
        steps {
          //sh 'echo $'
          sh 'docker build -t ${REGISTRY_ADDRESS}/lsepocnodejs:$BUILD_TIMESTAMP .'
      }
    }

    stage ('ACR Docker login') {
        steps {
          sh 'echo $'
          sh 'docker login $REGISTRY_ADDRESS -u $POC_ACR_CREDENTIALS_USR -p $POC_ACR_CREDENTIALS_PSW'
      }
    }

    // Uploading Docker images into ACR
    stage ('Push Image to ACR') {
     steps{
      sh 'docker push ${REGISTRY_ADDRESS}/$APPLICATION_NAME:$BUILD_TIMESTAMP'
      }
    }

  }

  post {
    always {
      sh 'docker logout'
    }
  }

}
