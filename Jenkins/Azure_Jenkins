pipeline {
  agent any
  
  environment {
    //once you create ACR in Azure cloud, use that here
    registryAddress = "lsepocnodejs.azurecr.io"
    //- update your credentials ID after creating credentials for connecting to ACR
     POC_ACR_CREDENTIALS = credentials('ACR_LSS_POC')
  }



  stages {
    stage ('Docker build image') {
        steps {
          //sh 'echo $'
          sh 'docker build -t ${registryAddress}/lsepocnodejs:$BUILD_TIMESTAMP .'
      }
    }

    stage ('ACR Docker login') {
        steps {
          //sh 'echo $'
          sh 'docker login $registryAddress -u POC_ACR_CREDENTIALS_USR -p POC_ACR_CREDENTIALS_PSW'
      }
    }

    // Uploading Docker images into ACR
    stage ('Push Image to ACR') {
     steps{
      sh 'docker push ${registryAddress}/lsepocnodejs:$BUILD_TIMESTAMP'
      }
    }

  }

  post {
    always {
      sh 'docker logout'
    }
  }

}
